# AI 路由与融合策略

## 角色
- 版本控制AI（v1/v2/v3 各实例）：技术更新、兼容性、回归审视
- 用户代码AI（v1/v2/v3 各实例）：代码审查、诊断、修复建议/教程
- 安全/合规审查模型：对输入/输出做策略过滤与拒绝
- 回归风险模型：对补丁/差异做风险评分
- 轻量补全模型：对候选答案 rerank/快启停

## 路由策略
- v1 域：允许 Shadow/A-B，主模型 + 安全审查模型 + 风险评分；结果写入 v1.review.findings
- v2 域：仅生产级路径；必须经过安全审查模型；禁用未签名模型
- v3 域：可访问外部源，但输出入内网需脱敏/过滤
- 模型选择依据：任务类型（审查/生成/诊断）、敏感度、性能预算、SLA

## 安全与审计
- mTLS + ACL；仅传元数据/摘要跨域
- 记录决策：路由决策、模型版本、风险评分、拒绝原因，落 `decision_logs`

## Shadow/A-B 规则
- Shadow：只记录不返回，用于新模型对比；指标：一致性/延迟/成本
- A/B：按流量比例路由；收集质量/性能反馈；未达标立即下线

