# 版本切换与回滚操作手册（分钟级）

## 前置检查
- 三重 AI 签名通过（v1/v3/v2）
- 预生产压测/场景模拟报告通过，阈值与基线对齐
- 监控阈值配置：延迟/错误率/资源/用户反馈告警
- 回滚资产：上一个稳定镜像、配置快照、数据库迁移回退/影子表方案

## 放量步骤（蓝绿/金丝雀示例）
1. 部署新版本到绿色环境，健康检查通过
2. 灰度 10% → 30% → 60% → 100%，每步观察 5-10 分钟指标
3. 监控：p50/p95/p99、错误率、CPU/Mem、长尾慢请求、反馈
4. 异常立刻触发 `release.rollback`，切回蓝色；数据库保持向后兼容

## 回滚步骤（分钟级）
1. 发出回滚指令（Argo Rollouts/流量切换）
2. 切回上一稳定镜像 + 配置；如涉及 DB，切到影子表/旧 schema 读写
3. 验证：健康检查 + 关键用户场景 + 指标回归
4. 记录事件：`rollbacks` 表 & `tech.baseline.update`，附异常原因

## 风控检查表
- 是否存在破坏性 API 变更？若有，开启双轨/特性开关
- 是否准备好迁移脚本与回退脚本？向后兼容验证完成
- 是否启用限流/熔断/重试策略，防止雪崩
- 监控与告警是否就绪，Dashboard 链接可用

