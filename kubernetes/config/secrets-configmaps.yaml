# =============================================================================
# Kubernetes Secrets and ConfigMaps for AI Code Review Platform
# =============================================================================
# IMPORTANT: Replace placeholder values before deployment
# Use: kubectl apply -f secrets-configmaps.yaml
# =============================================================================

---
# =============================================================================
# Namespace
# =============================================================================
apiVersion: v1
kind: Namespace
metadata:
  name: ai-codereview
  labels:
    name: ai-codereview

---
# =============================================================================
# Redis ConfigMap
# =============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-config
  namespace: ai-codereview
data:
  url: "redis://redis:6379"
  host: "redis"
  port: "6379"

---
# =============================================================================
# Service Configuration ConfigMap
# =============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: service-config
  namespace: ai-codereview
data:
  ENVIRONMENT: "production"
  LOG_LEVEL: "INFO"
  LOG_FORMAT: "json"

  # Service URLs
  AUTH_SERVICE_URL: "http://auth-service:8000"
  PROJECT_SERVICE_URL: "http://project-service:8000"
  ANALYSIS_SERVICE_URL: "http://analysis-service:8000"
  AI_ORCHESTRATOR_URL: "http://ai-orchestrator:8000"
  VERSION_CONTROL_SERVICE_URL: "http://version-control-service:8000"
  COMPARISON_SERVICE_URL: "http://comparison-service:8000"
  PROVIDER_SERVICE_URL: "http://provider-service:8000"

  # Rate Limiting
  RATE_LIMIT_REQUESTS: "100"
  RATE_LIMIT_WINDOW: "60"

  # Timeouts
  REQUEST_TIMEOUT: "30"
  AI_REQUEST_TIMEOUT: "60"

---
# =============================================================================
# Database Credentials Secret
# =============================================================================
# WARNING: In production, use external secret management (Vault, AWS Secrets Manager)
# These are placeholder values - REPLACE before deployment
apiVersion: v1
kind: Secret
metadata:
  name: database-credentials
  namespace: ai-codereview
type: Opaque
stringData:
  # PostgreSQL connection strings
  # Format: postgresql://user:password@host:port/database
  auth-db-url: "postgresql://auth_user:CHANGE_ME@postgres:5432/auth_db"
  project-db-url: "postgresql://project_user:CHANGE_ME@postgres:5432/project_db"
  analysis-db-url: "postgresql://analysis_user:CHANGE_ME@postgres:5432/analysis_db"
  experiment-db-url: "postgresql://experiment_user:CHANGE_ME@postgres:5432/experiment_db"

  # Root credentials (for migrations)
  postgres-user: "postgres"
  postgres-password: "CHANGE_ME"

---
# =============================================================================
# JWT Secrets
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: jwt-secrets
  namespace: ai-codereview
type: Opaque
stringData:
  # JWT Secret Key - MUST be changed in production
  # Generate with: openssl rand -hex 64
  secret-key: "CHANGE_THIS_TO_A_SECURE_RANDOM_STRING_AT_LEAST_64_CHARACTERS_LONG"

  # JWT Configuration
  access-token-expire-minutes: "15"
  refresh-token-expire-days: "7"
  algorithm: "HS256"

---
# =============================================================================
# AI Provider Secrets
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: ai-provider-secrets
  namespace: ai-codereview
type: Opaque
stringData:
  # OpenAI API Key
  openai-api-key: "sk-CHANGE_ME"

  # Anthropic API Key
  anthropic-api-key: "sk-ant-CHANGE_ME"

  # HuggingFace API Token (optional)
  huggingface-token: ""

  # Encryption key for storing user API keys
  # Generate with: openssl rand -base64 32
  encryption-key: "CHANGE_ME_32_BYTE_KEY_BASE64_ENCODED"

---
# =============================================================================
# 2FA Encryption Secret
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: two-factor-secrets
  namespace: ai-codereview
type: Opaque
stringData:
  # Fernet encryption key for 2FA secrets
  # Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
  encryption-key: "CHANGE_ME_FERNET_KEY"

---
# =============================================================================
# TLS Certificate Secret (for Ingress)
# =============================================================================
# Note: In production, use cert-manager for automatic certificate management
apiVersion: v1
kind: Secret
metadata:
  name: tls-secret
  namespace: ai-codereview
type: kubernetes.io/tls
data:
  # Base64 encoded TLS certificate and key
  # Replace with actual certificate data
  tls.crt: ""
  tls.key: ""

---
# =============================================================================
# Image Pull Secret (for private registry)
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: gcr-secret
  namespace: ai-codereview
type: kubernetes.io/dockerconfigjson
data:
  # Base64 encoded Docker config JSON
  # Generate with: kubectl create secret docker-registry gcr-secret --docker-server=gcr.io --docker-username=_json_key --docker-password="$(cat key.json)" --dry-run=client -o yaml
  .dockerconfigjson: ""
